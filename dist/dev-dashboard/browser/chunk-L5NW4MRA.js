import{Aa as a,ba as n,fa as i,k as r,mc as o,oc as u,pc as h}from"./chunk-C5GZDSUZ.js";var p=class s{constructor(e,t){this.http=e;this.platformId=t;this.isBrowser=o(this.platformId),this.isBrowser&&this.loadStoredAuth()}currentUserSubject=new r(null);tokenSubject=new r(null);isAuthenticatedSubject=new r(!1);currentUser$=this.currentUserSubject.asObservable();token$=this.tokenSubject.asObservable();isAuthenticated$=this.isAuthenticatedSubject.asObservable();apiUrl="http://localhost:4000/api";isBrowser;loadStoredAuth(){if(!this.isBrowser)return;let e=localStorage.getItem("auth_token"),t=localStorage.getItem("auth_user");if(e&&t)try{this.tokenSubject.next(e),this.currentUserSubject.next(JSON.parse(t)),this.isAuthenticatedSubject.next(!0)}catch(c){console.error("Failed to parse stored auth data:",c),this.clearStoredAuth()}}clearStoredAuth(){this.isBrowser&&(localStorage.removeItem("auth_token"),localStorage.removeItem("auth_user"))}getAuthHeaders(){let e=this.tokenSubject.value;return new u({"Content-Type":"application/json",Authorization:`Bearer ${e}`})}register(e,t){return this.http.post(`${this.apiUrl}/auth/register`,{email:e,password:t})}login(e,t){return this.http.post(`${this.apiUrl}/auth/login`,{email:e,password:t})}logout(){this.clearStoredAuth(),this.tokenSubject.next(null),this.currentUserSubject.next(null),this.isAuthenticatedSubject.next(!1)}setAuth(e,t){this.isBrowser&&(localStorage.setItem("auth_token",e),localStorage.setItem("auth_user",JSON.stringify(t))),this.tokenSubject.next(e),this.currentUserSubject.next(t),this.isAuthenticatedSubject.next(!0)}getCurrentUser(){return this.currentUserSubject.value}getToken(){return this.tokenSubject.value}isAuthenticated(){return this.isAuthenticatedSubject.value}getUserData(){return this.http.get(`${this.apiUrl}/user/data`,{headers:this.getAuthHeaders()})}updateKanbanTasks(e){return this.http.put(`${this.apiUrl}/user/kanban-tasks`,{kanbanTasks:e},{headers:this.getAuthHeaders()})}updateFocusTimer(e){return this.http.put(`${this.apiUrl}/user/focus-timer`,{focusTimer:e},{headers:this.getAuthHeaders()})}updateMarkdownNote(e){return this.http.put(`${this.apiUrl}/user/markdown-note`,{markdownNote:e},{headers:this.getAuthHeaders()})}updateSnippets(e){return this.http.put(`${this.apiUrl}/user/snippets`,{snippets:e},{headers:this.getAuthHeaders()})}updatePreferences(e){return this.http.put(`${this.apiUrl}/user/preferences`,{preferences:e},{headers:this.getAuthHeaders()})}resendVerification(e){return this.http.post(`${this.apiUrl}/auth/resend-verification`,{email:e})}static \u0275fac=function(t){return new(t||s)(i(h),i(a))};static \u0275prov=n({token:s,factory:s.\u0275fac,providedIn:"root"})};export{p as a};
